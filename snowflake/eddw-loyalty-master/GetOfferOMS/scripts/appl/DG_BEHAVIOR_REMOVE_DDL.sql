
--liquibase formatted sql
--changeset SYSTEM:DG_BEHAVIOR_REMOVE_DDL runOnChange:true splitStatements:false OBJECT_TYPE:TABLE

USE DATABASE <<EDM_DB_NAME>>;
USE SCHEMA DW_C_STAGE;

create or replace TRANSIENT TABLE <<EDM_DB_NAME>>.DW_C_STAGE.GetOfferOMS_Flat_Rerun
AS SELECT * FROM <<EDM_DB_NAME_R>>.DW_APPL.GetOfferOMS_Flat_R_STREAM WHERE 1=2;

ALTER TABLE <<EDM_DB_NAME>>.DW_C_STAGE.GetOfferOMS_Flat_Rerun ALTER COLUMN METADATA$ACTION VARCHAR, METADATA$ROW_ID VARCHAR;

create or replace TRANSIENT TABLE <<EDM_DB_NAME>>.DW_C_STAGE.GetOfferOMS_Flat_Main_WRK
AS SELECT * FROM <<EDM_DB_NAME>>.DW_C_STAGE.GetOfferOMS_Flat_Rerun WHERE 1=2;


create or replace TRANSIENT TABLE OMS_OFFER_WRK (
	OMS_OFFER_ID VARCHAR(16777216),
	EXTERNAL_OFFER_ID VARCHAR(16777216),
	OFFER_REQUEST_ID VARCHAR(16777216),
	AGGREGATOR_OFFER_ID VARCHAR(16777216),
	MANUFACTURER_ID VARCHAR(16777216),
	MANUFACTURER_OFFER_REFERENCE_CD VARCHAR(16777216),
	PROVIDER_NM VARCHAR(16777216),
	CATEGORIES_TXT VARCHAR(16777216),
	PRIMARY_CATEGORY_TXT VARCHAR(16777216),
	PROGRAM_CD VARCHAR(16777216),
	PROGRAM_CODE_DSC VARCHAR(16777216),
	SUBPROGRAM_NM VARCHAR(16777216),
	SUBPROGRAM_DSC VARCHAR(16777216),
	DELIVERY_CHANNEL_CD VARCHAR(16777216),
	DELIVERY_CHANNEL_DSC VARCHAR(16777216),
	OFFER_STATUS_CD VARCHAR(16777216),
	OFFER_STATUS_DSC VARCHAR(16777216),
	PRICE_TITLE_TXT VARCHAR(16777216),
	PRICE_VALUE_TXT VARCHAR(16777216),
	SAVINGS_VALUE_TXT VARCHAR(16777216),
	TITLE_DSC VARCHAR(16777216),
	TITLE_DSC1 VARCHAR(16777216),
	TITLE_DSC2 VARCHAR(16777216),
	TITLE_DSC3 VARCHAR(16777216),
	PRODUCT_DSC VARCHAR(16777216),
	PRODUCT_DSC1 VARCHAR(16777216),
	PRODUCT_DSC2 VARCHAR(16777216),
	PRODUCT_DSC3 VARCHAR(16777216),
	DISCLAIMER_TXT VARCHAR(16777216),
	DESCRIPTION_TXT VARCHAR(16777216),
	PRINT_TAGS_IND BOOLEAN,
	PRODUCT_IMAGE_ID VARCHAR(16777216),
	PRICE_CD VARCHAR(16777216),
	TIME_TXT VARCHAR(16777216),
	YEAR_TXT VARCHAR(16777216),
	PRODUCT_CD VARCHAR(16777216),
	IS_EMPLOYEE_OFFER_IND BOOLEAN,
	IS_DEFAULT_ALLOCATION_OFFER_IND BOOLEAN,
	PROGRAM_TYPE_CD VARCHAR(16777216),
	SHOULD_REPORT_REDEPTIONS_IND VARCHAR(16777216),
	CREATED_TS TIMESTAMP_LTZ(9),
	CREATED_APPLICATION_ID VARCHAR(16777216),
	CREATED_USER_ID VARCHAR(16777216),
	LAST_UPDATED_APPLICATION_ID VARCHAR(16777216),
	LAST_UPDATED_USER_ID VARCHAR(16777216),
	LAST_UPDATED_TS TIMESTAMP_LTZ(9),
	DISPLAY_EFFECTIVE_START_DT DATE,
	DISPLAY_EFFECTIVE_END_DT DATE,
	EFFECTIVE_START_DT DATE,
	EFFECTIVE_END_DT DATE,
	TEST_EFFECTIVE_START_DT DATE,
	TEST_EFFECTIVE_END_DT DATE,
	QUALIFICATION_UNIT_TYPE_DSC VARCHAR(16777216),
	QUALIFICATION_UNITE_SUBTYPE_DSC VARCHAR(16777216),
	BENEIFIT_VALUE_TYPE_DSC VARCHAR(16777216),
	USAGE_LIMIT_TYPE_PER_USER_DSC VARCHAR(16777216),
	PLU_TRIGGER_BARCODE_TXT VARCHAR(16777216),
	COPIENT_CATEGORY_DSC VARCHAR(16777216),
	ENGINE_DSC VARCHAR(16777216),
	PRIORITY_CD VARCHAR(16777216),
	TIERS_CD VARCHAR(16777216),
	SEND_OUTBOUND_DATA_DSC VARCHAR(16777216),
	CHARGEBACK_VENDOR_NM VARCHAR(16777216),
	AUTO_TRANSFERABLE_IND BOOLEAN,
	ENABLE_ISSUANCE_IND BOOLEAN,
	DEFER_EVALUATION_UNTIL_EOS_IND BOOLEAN,
	ENABLE_IMPRESSION_REPORTING_IND BOOLEAN,
	LIMIT_ELIGIBILITY_FREQUENCY_TXT VARCHAR(16777216),
	IS_APPLIABLE_TO_J4U_IND BOOLEAN,
	CUSTOMER_SEGMENT_DSC VARCHAR(16777216),
	ASSIGNMENT_USER_ID VARCHAR(16777216),
	ASSIGNMENT_FIRST_NM VARCHAR(16777216),
	ASSIGNMENT_LAST_NM VARCHAR(16777216),
	QUALIFICATION_PRODUCT_DISQUALIFIER_TXT VARCHAR(16777216),
	QUALIFICATION_DAY_MONDAY_IND BOOLEAN,
	QUALIFICATION_DAY_TUESDAY_IND BOOLEAN,
	QUALIFICATION_DAY_WEDNESDAY_IND BOOLEAN,
	QUALIFICATION_DAY_THURSDAY_IND BOOLEAN,
	QUALIFICATION_DAY_FRIDAY_IND BOOLEAN,
	QUALIFICATION_DAY_SATURDAY_IND BOOLEAN,
	QUALIFICATION_DAY_SUNDAY_IND BOOLEAN,
	QUALIFICATION_START_TIME_TXT VARCHAR(16777216),
	QUALIFICATION_END_TIME_TXT VARCHAR(16777216),
	QUALIFICATION_ENTERPRISE_INSTANT_WIN_NUMBER_OF_PRIZES_QTY VARCHAR(16777216),
	QUALIFICATION_ENTERPRISE_INSTANT_WIN_FREQUENCY_TXT VARCHAR(16777216),
	OFFER_NM VARCHAR(16777216),
	AD_TYPE_CD VARCHAR(16777216),
	OFFER_PROTOTYPE_CD VARCHAR(16777216),
	OFFER_PROTOTYPE_DSC VARCHAR(16777216),
	STORE_GROUP_VERSION_ID VARCHAR(16777216),
	STORE_TAG_PRINT_J4U_TAG_ENABLED_IND BOOLEAN,
	STORE_TAG_MULTIPLE_NBR VARCHAR(16777216),
	STORE_TAG_AMT VARCHAR(16777216),
	STORE_TAG_COMMENTS_TXT VARCHAR(16777216),
	REQUESTED_REMOVAL_FOR_ALL_IND BOOLEAN,
	REMOVED_ON_TS TIMESTAMP_LTZ(9),
	REMOVED_UNCLIPPED_ON_TS TIMESTAMP_LTZ(9),
	REMOVAL_FOR_ALL_ON_TS TIMESTAMP_LTZ(9),
	BRAND_SIZE_DSC VARCHAR(16777216),
	CREATED_USER_USER_ID VARCHAR(16777216),
	CREATED_USER_FIRST_NM VARCHAR(16777216),
	CREATED_USER_LAST_NM VARCHAR(16777216),
	UPDATED_USER_USER_ID VARCHAR(16777216),
	UPDATED_USER_FIRST_NM VARCHAR(16777216),
	UPDATED_USER_LAST_NM VARCHAR(16777216),
	FIRST_UPDATE_TO_REDEMPTION_ENGINE_TS TIMESTAMP_LTZ(9),
	LAST_UPDATE_TO_REDEMPTION_ENGINE_TS TIMESTAMP_LTZ(9),
	FIRST_UPDATE_TO_J4U_TS TIMESTAMP_LTZ(9),
	LAST_UPDATE_TO_J4U_TS TIMESTAMP_LTZ(9),
	OFFER_REQUESTOR_GROUP_CD VARCHAR(16777216),
	HEADLINE_TXT VARCHAR(16777216),
	IS_POD_APPROVED_IND BOOLEAN,
	POD_USAGE_LIMIT_TYPE_PER_USER_DSC VARCHAR(16777216),
	POD_REFERENCE_OFFER_ID VARCHAR(16777216),
	IVIE_IMAGE_ID VARCHAR(16777216),
	VEHICLE_NAME_TXT VARCHAR(16777216),
	AD_PAGE_NUMBER_TXT VARCHAR(16777216),
	AD_MOD_NBR VARCHAR(16777216),
	ECOM_DSC VARCHAR(16777216),
	REQUESTED_USER_USER_ID VARCHAR(16777216),
	REQUESTED_USER_FIRST_NM VARCHAR(16777216),
	REQUESTED_USER_LAST_NM VARCHAR(16777216),
	IS_PRIMARY_POD_OFFER_IND BOOLEAN,
	IN_EMAIL_IND VARCHAR(16777216),
	SUBMITTED_DT DATE,
	REDEMPTION_SYSTEM_ID VARCHAR(16777216),
	ADBUG_TXT VARCHAR(16777216),
	DW_LOGICAL_DELETE_IND BOOLEAN,
	LASTUPDATETS VARCHAR(16777216),
	FILENAME VARCHAR(16777216),
	ALLOCATION_CD VARCHAR(16777216),
	ALLOCATION_NM VARCHAR(16777216),
	PRINTED_MESSAGE_NOTIFICATION_IND VARCHAR(16777216),
	CASHIER_MESSAGE_NOTIFICATION_IND VARCHAR(16777216),
	CUSTOM_OFFER_LIMIT_NBR VARCHAR(16777216),
	CUSTOM_PERIOD_NBR VARCHAR(16777216),
	CUSTOM_TYPE_DSC VARCHAR(16777216),
	QUALIFICATION_PRODUCT_DISQUALIFIER_NM VARCHAR(16777216),
	IS_DISPLAY_IMMEDIATE_IND BOOLEAN,
	ECOMM_PROMO_TYPE_CD VARCHAR(16777216),
	PROMOTION_ORDER_NBR VARCHAR(16777216),
	HEADLINE2_TXT VARCHAR(16777216),
	USAGE_LIMIT_PER_OFFER_CNT VARCHAR(16777216),
	REFUNDABLE_REWARDS_IND BOOLEAN,
	MULTI_CLIP_LIMIT_CNT VARCHAR(16777216),
	DML_TYPE VARCHAR(16777216),
	SAMEDAY_CHG_IND NUMBER(38,0),
	PAYLOAD_POINTS VARCHAR(16777216),
	PAYLOAD_PROGRAMSUBTYPE VARCHAR(16777216),
	ECOMM_PROMO_TYPE_NM VARCHAR(16777216),
	AUTO_APPLY_PROMO_IND BOOLEAN,
	VALID_WITH_OTHER_OFFERS_IND BOOLEAN,
	OFFER_ELIGIBLE_ORDER_CNT VARCHAR(16777216),
	VALID_FOR_FIRST_TIME_CUSTOMER_IND BOOLEAN,
	MERKLE_GAME_LAND_NM VARCHAR(16777216),
	MERKLE_GAME_LAND_SPACE_NM VARCHAR(16777216),
	MERKLE_GAME_LAND_SPACE_SLOT_NM VARCHAR(16777216),
	PROMOTION_SUBPROGRAM_TYPE_CD VARCHAR(16777216),
	OFFER_QUALIFICATION_BEHAVIOR_CD VARCHAR(16777216),
	INITIAL_SUBSCRIPTION_OFFER_IND BOOLEAN,
	DYNAMIC_OFFER_IND BOOLEAN,
	DAYS_TO_REDEEM_OFFER_CNT VARCHAR(16777216),
	OFFER_CLIPPABLE_IND BOOLEAN,
	OFFER_APPLICABLE_ONLINE_IND BOOLEAN,
	OFFER_DISPLAYABLE_IND BOOLEAN
);

USE DATABASE <<EDM_ANALYTICS>>;
USE SCHEMA DW_STAGE;

create or replace transient table OfferOMS_Flat_Rerun
as
select * from <<EDM_DB_NAME>>.DW_C_PRODUCT.OfferOMS_Flat_C_STREAM where 1=2;

ALTER TABLE OfferOMS_Flat_Rerun ALTER COLUMN METADATA$ACTION VARCHAR, METADATA$ROW_ID VARCHAR;

use database <<EDM_DB_NAME_OUT>>;
use schema dw_stage;

CREATE OR REPLACE transient table EPE_OFFEROMS_O_RERUN
AS
select * from <<EDM_DB_NAME>>.dw_appl.GetOfferOMS_Flat_C_Stream where 1=2;

alter table EPE_OFFEROMS_O_RERUN ALTER COLUMN METADATA$ACTION VARCHAR, METADATA$ROW_ID VARCHAR;

create or replace transient table EPE_OFFEROMS_O_WRK as
select * From EPE_OFFEROMS_O_RERUN where 1=2;
